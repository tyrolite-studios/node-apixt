(()=>{"use strict";function t(t,...e){let n=[];try{throw Error("foo")}catch(t){n=t.stack.split("\n")}const r=[];let o=0;for(const t of n){const e=o;if(o++,e<=1)continue;if(2===e){r.push(t.trim());continue}if(e>6)break;const[n]=t.split("(");r.push(n.substring(6).trim())}return console.group("Debug "+r.join(" <- ")),console.log(t,...e),console.groupEnd(),t}const e=t=>null===t;function n(t){return"string"==typeof t}function r(t){return Array.isArray(t)}function o(t){return!!t&&"object"==typeof t&&!r(t)}function s(t){return"number"==typeof t&&!isNaN(t)}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t&&Number.isInteger(t)}function d(t){return"boolean"==typeof t}function c(t){if(!t)return[];const e=/\b(full|w-full|h-full)\b/g;return t.match(e)||[]}class u{constructor(t="",e=""){this.cls=[],this.add(t),this.overwrites=e}add(t=""){t&&this.cls.push(t)}addIf(t,e,n=""){t?this.add(e):this.add(n)}addIfProps(t){for(const[e,n]of Object.entries(t))i(n)&&(n=n()),n&&this.add(e)}getDeletesAndAdds(){const t=this.overwrites.split(" "),e=[],n=[];for(const r of t)r.startsWith("not_")?e.push(r.substring(4)):n.push(r);return{adds:n,deletes:e}}get value(){const t=this.cls.join(" ");if(!this.overwrites)return t;const{adds:e,deletes:n}=this.getDeletesAndAdds(),r=undefined;return[...t.split(" ").filter((t=>!n.includes(t))),...e].join(" ")}}function l(t,e){const n=t.clientX,r=t.clientY;return n>=e.left&&n<=e.right&&r>=e.top&&r<=e.bottom}function g(t,e,n){return!(void 0!==e&&t<e)&&!(void 0!==n&&t>n)}const p=t=>{try{return JSON.parse(t),!0}catch(t){return!1}};function f(t,e,n){const r=null===t?e:Math.max(t,e);return null==n?r:Math.min(r,n)}const m=(t,e=0,n=!1)=>{const r=e;let o=1;for(;e-- >0;)o*=10;let s=Math.round(t*o)/o;if(n){const t=(""+s).split(".");1===t.length&&t.push(""),t[1]=t[1].padEnd(r,"0"),s=t.join(".")}return s};function h(t){if(void 0!==t){if(null===t)return null;if(Array.isArray(t))return t.map((t=>h(t)));if("object"==typeof t){const e={};for(let[n,r]of Object.entries(t))e[n]=h(r);return e}return t}}function b(t){return"undefined"!=typeof DOMException&&t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)}const v=(t,e="")=>{let r=!1;const o=new Set,s=e.length;for(let n=0;n<t.length;n++){const r=t.key(n);r.startsWith(e)&&o.add(r.substring(s))}const i={get:(n,r)=>{const o=t.getItem(e+n);return null===o?r:o},getJson:(t,e)=>i.getByType("json",t,e),getByType:(t,e,n)=>{const r=i.get(e+"_"+t);if(void 0===r)return n;switch(t){case"json":return JSON.parse(r)}throw Error(`Unsupported type "${t}" for decoding given!`)},has:t=>o.has(t),hasJson:t=>i.hasByType(t,"json"),hasByType:(t,e)=>i.has(t+"_"+e),set:(s,i)=>{if(!n(i))throw Error(`Expected value for id "${s}" to be a string but got ${typeof i}`);try{t.setItem(e+s,i)}catch(t){return b(t)&&(r=!0),!1}return o.add(s),!0},setJson:(t,e)=>i.setByType("json",t,e),setByType:(t,e,n)=>{if(void 0===n)throw Error(`Cannot store undefined value for id "${e}"`);const r=i.encode(t,n);return i.set(e+"_"+t,r)},delete:n=>!!o.has(n)&&(t.removeItem(e+n),o.delete(n),r=!1,!0),deleteJson:t=>i.deleteByType("json",t),deleteByType:(t,e)=>i.delete(e+"_"+t),keys:()=>[...o],isAvailable:()=>{try{const e="__storage_test__";return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return"undefined"!=typeof DOMException&&e instanceof DOMException&&!b(e)&&(22===e.code||1014===e.code)&&t&&0!==t.length}},isFull:()=>r,size:()=>o.size,encode:(t,e)=>{switch(t){case"json":return JSON.stringify(e)}throw Error(`Unsupported type "${t}" for encoding given!`)}};return i},w=()=>{const t=new Map;return v({setItem:(e,n)=>t.set(e,n),getItem:e=>{const n=t.get(e);return void 0===n?null:n},hasItem:e=>t.has(e)})},y={};let x=null,E=null,S=null,A=null,k=null,I=!0,j=null;const J={getStorages:()=>{if(!x){if(null===j)throw Error("No store prefix was set");const t=`${j}${A}.`;x={global:v(localStorage,`${j}global.`),api:v(localStorage,t),session:v(sessionStorage,t),temp:w()}}return x},clearJwtCookie(){document.cookie=`${k}=; Max-Age=-9999; path=/`},clearJwt(){J.tokenStorage.delete("jwt"),J.clearJwtCookie()},setJwt(t){J.tokenStorage.set("jwt",t),document.cookie=`${k}=${t}; path=/`},getStoredJwt:()=>J.tokenStorage.get("jwt"),set apiId(t){A=t},set permanent(t){I=t},set storePrefix(t){j=t},set jwtCookieKey(t){k=t},get fixJwt(){return S},set fixJwt(t){S=t},get globalStorage(){return J.getStorages().global},get apiStorage(){return J.getStorages().api},get sessionStorage(){return J.getStorages().session},get tempStorage(){return J.getStorages().temp},get tokenStorage(){return J[I?"apiStorage":"sessionStorage"]},registerApp:(t,e,n)=>{y[t]={create:e,destroy:n}},setAppOverwrites:(t,e)=>{J.hasApp(t,!0),y[t].overwrites=e},hasApp:(t,e=!1)=>{const n=!!y[t];if(e&&!n)throw Error(`App with id "${t}" was not registered`);return n},startApp:(t,e={})=>{const n=y[t];if(!n)throw Error(`Invalid app id "${t}" given!`);n.config?e=n.config:n.config=e;const{create:r,overwrites:o={}}=n,s=()=>{requestAnimationFrame((()=>{E=t;const n=()=>{r({...e,...o})};"loading"===document.readyState?addEventListener("DOMContentLoaded",n,{once:!0}):n()}))};if(E){const{destroy:t}=y[E];t&&t(),requestAnimationFrame((()=>s()))}else s()}};window.controller=J;const B=J,$=new URL(window.location.href);$.search="";const T=$.toString();let O=null;const _=()=>O().catch((t=>{console.error(t),D(),document.getElementById("error-info").innerText=t.message,document.getElementById("retry-btn").focus()})),C=t=>{O=t,_()},D=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!1)},L=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!0)};function M(t){B.apiId=t.apiId,B.permanent=t.permanent,B.storePrefix=t.storePrefix,B.jwtCookieKey=t.jwtCookieKey;const e=t=>{if(B.hasApp("apixt"))B.startApp("apixt",t);else{const t=document.createElement("script");t.src=`${T}/index.js`,document.head.appendChild(t)}},n=()=>{B.setJwt(B.fixJwt),e({})},r=()=>{const t=B.tokenStorage.get("lastUsername"),r=document.getElementById("username");t&&(r.value=t),r.value&&document.getElementById("password").focus();const o=B.getStoredJwt();if(B.fixJwt)return o===B.fixJwt?n():B.clearJwt(),void 0;o&&!B.hasApp("apixt")&&C((()=>fetch(T+"/refresh",{headers:{Authorization:`Bearer ${o}`}}).then((t=>{if(401===t.status)return B.clearJwt(),void 0;if(!t.ok||200!==t.status)throw Error(`Could not refresh token. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{jwt:n,config:r}=t;B.setJwt(n),e(r)}))))},o=function(t){t.preventDefault();const r=new FormData(document.getElementById("login-form")),o=new URLSearchParams(r),s=r.get("username");if(s&&B.tokenStorage.set("lastUsername",s),B.fixJwt)return n(),void 0;C((()=>fetch(T,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then((t=>{if(401===t.status){const t=document.getElementById("login-form").classList;t.toggle("shake-anim",!0);const e=document.getElementsByTagName("input");for(const t of e)t.setAttribute("maxlength","0");return setTimeout((()=>{t.remove("shake-anim");for(const t of e)t.removeAttribute("maxlength");document.getElementById("password").focus()}),500),void 0}if(!t.ok)throw Error(`Could not login. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{config:n,jwt:r}=t;B.setJwt(r),e(n)}))))};document.body.innerHTML='<div class="full bg-app-bg text-app-text"><div id="overlay" class="hidden full bg-overlay-bg/50 absolute"><div class="grid place-items-center h-full w-full"><div class="text-center bg-warning-bg text-warning-text w-full py-3"><div class="stack-v gap-3"><div class="text-warning-text/50">An error occured:</div><div id="error-info"></div><div class="stack-h gap-2 place-content-center"><button id="retry-btn" class="bg-button-bg text-button-text border-button-border border px-2">Retry</button><button id="cancel-btn" class="bg-button-bg text-button-text border-button-border border px-2">Cancel</button></div></div></div ></div></div><div class="grid place-content-center h-full"><form id="login-form" class="text-center"><div id="login-div" class="stack-v gap-2 border-header-border border shadow-md"><div class="bg-header-bg text-header-text px-2">Login</div><div class="grid gap-1 py-1 grid-cols-[min-content_auto] p-3"><div class="text-xs">Username:</div><input id="username" name="username" type="text" autocomplete="username" required class="invalid:bg-warning-bg invalid:text-warning-text px-2 bg-input-bg text-input-text border-input-border" /><div class="text-xs">Password:</div><input id="password" type="password" name="password" autocomplete="current-password" required class="invalid:bg-warning-bg invalid:text-warning-text px-2 bg-input-bg text-input-text border-input-border" /></div><div class="pb-2"><button type="submit" class="bg-button-bg text-button-text border border-button-border text-xs px-2">Submit</button></div></div></div></form></div></div>',document.getElementById("login-form").addEventListener("submit",o),document.getElementById("retry-btn").addEventListener("click",(()=>{L(),_()})),document.getElementById("cancel-btn").addEventListener("click",L),requestAnimationFrame((()=>r()))}B.registerApp("login",M)})();