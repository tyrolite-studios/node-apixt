(()=>{"use strict";function t(t,...e){let n=[];try{throw Error("foo")}catch(t){n=t.stack.split("\n")}const r=[];let o=0;for(const t of n){const e=o;if(o++,e<=1)continue;if(2===e){r.push(t.trim());continue}if(e>6)break;const[n]=t.split("(");r.push(n.substring(6).trim())}return console.group("Debug "+r.join(" <- ")),console.log(t,...e),console.groupEnd(),t}const e=t=>null===t;function n(t){return"string"==typeof t}function r(t){return Array.isArray(t)}function o(t){return!!t&&"object"==typeof t&&!r(t)}function s(t){return"number"==typeof t&&!isNaN(t)}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t&&Number.isInteger(t)}function u(t){return"boolean"==typeof t}function c(t){if(!t)return[];const e=/\b(full|w-full|h-full)\b/g;return t.match(e)||[]}function d(t){const e=new l(t);return new Proxy(e,{set:(t,n,r)=>(e.add(n,r),!0)})}class l{constructor(t={}){this._props={},this.add(t)}get style(){let t=this._props.style;return t||(t={},this._props.style=t),t}get props(){return this._props}setStyle(t,e){return this.style[t]=e,this}setStyles(t){for(const[e,n]of Object.entries(t))this.setStyle(e,n);return this}add(t,e){if(o(t)){for(const[e,n]of Object.entries(t))this._props[e]=n;return this}return this._props[t]=e,this}}function p(t="",e=""){return new g(t,e)}class g{constructor(t="",e=""){this.cls=[],this.add(t),this.overwrites=e}add(t=""){t&&this.cls.push(t)}addIf(t,e,n=""){t?this.add(e):this.add(n)}addIfProps(t){for(const[e,n]of Object.entries(t))i(n)&&(n=n()),n&&this.add(e)}getDeletesAndAdds(){const t=this.overwrites.split(" "),e=[],n=[];for(const r of t)r.startsWith("not_")?e.push(r.substring(4)):n.push(r);return{adds:n,deletes:e}}get value(){const t=this.cls.join(" ");if(!this.overwrites)return t;const{adds:e,deletes:n}=this.getDeletesAndAdds(),r=undefined;return[...t.split(" ").filter((t=>!n.includes(t))),...e].join(" ")}}function f(t,e){const n=t.clientX,r=t.clientY;return n>=e.left&&n<=e.right&&r>=e.top&&r<=e.bottom}function h(t,e,n){return!(void 0!==e&&t<e)&&!(void 0!==n&&t>n)}const b=t=>{try{return JSON.parse(t),!0}catch(t){return!1}};function m(t,e,n){const r=null===t?e:Math.max(t,e);return null==n?r:Math.min(r,n)}const y=(t,e=0,n=!1)=>{const r=e;let o=1;for(;e-- >0;)o*=10;let s=Math.round(t*o)/o;if(n){const t=(""+s).split(".");1===t.length&&t.push(""),t[1]=t[1].padEnd(r,"0"),s=t.join(".")}return s};function v(t){if(void 0!==t){if(null===t)return null;if(Array.isArray(t))return t.map((t=>v(t)));if("object"==typeof t){const e={};for(let[n,r]of Object.entries(t))e[n]=v(r);return e}return t}}function w(t,e){for(const[n,r]of Object.entries(t))e[n]=r}function x(t){const[e,n,r,o]=t.split(" ");return"#"+parseInt(e).toString(16).padStart(2,"0")+parseInt(n).toString(16).padStart(2,"0")+parseInt(r).toString(16).padStart(2,"0")+(void 0===o?"":parseInt(o).toString(16).padStart(2,"0"))}function S(t){const e=t.substring(1).split("/"),n=[];let r=-1,o="^";for(const t of e)t.startsWith(":")?(r++,n.push({fix:!1,value:t.substring(1),ref:r}),o+="\\/([^\\/:?]+)"):(n.push({fix:!0,value:t}),o+="\\/"+t);return o+="$",{path:t,components:n,varCount:r+1,regexp:o}}function E(t,e){if(!t.varCount)return[];const n=undefined,r=new RegExp(t.regexp).exec(e);if(null===r)return[];const o=[];let s=0;for(;s<t.varCount;)s++,o.push(r[s]);return o}const k=(t,e)=>e instanceof Object&&!(e instanceof Array)?Object.keys(e).sort().reduce(((t,n)=>(t[n]=e[n],t)),{}):e;function A(t){n(t)||(t=JSON.stringify(t,k));var e="0123456789abcdef";function r(t){var n,r="";for(n=0;n<=3;n++)r+=e.charAt(t>>8*n+4&15)+e.charAt(t>>8*n&15);return r}function o(t,e){var n=(65535&t)+(65535&e),r;return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function s(t,e){return t<<e|t>>>32-e}function i(t,e,n,r,i,a){return o(s(o(o(e,t),o(r,a)),i),n)}function a(t,e,n,r,o,s,a){return i(e&n|~e&r,t,e,o,s,a)}function u(t,e,n,r,o,s,a){return i(e&r|n&~r,t,e,o,s,a)}function c(t,e,n,r,o,s,a){return i(e^n^r,t,e,o,s,a)}function d(t,e,n,r,o,s,a){return i(n^(e|~r),t,e,o,s,a)}function l(t){var e,n=1+(t.length+8>>6),r=new Array(16*n);for(e=0;e<16*n;e++)r[e]=0;for(e=0;e<t.length;e++)r[e>>2]|=t.charCodeAt(e)<<e%4*8;return r[e>>2]|=128<<e%4*8,r[16*n-2]=8*t.length,r}var p,g=l(""+t),f=1732584193,h=-271733879,b=-1732584194,m=271733878,y,v,w,x;for(p=0;p<g.length;p+=16)y=f,v=h,w=b,x=m,f=a(f,h,b,m,g[p+0],7,-680876936),m=a(m,f,h,b,g[p+1],12,-389564586),b=a(b,m,f,h,g[p+2],17,606105819),h=a(h,b,m,f,g[p+3],22,-1044525330),f=a(f,h,b,m,g[p+4],7,-176418897),m=a(m,f,h,b,g[p+5],12,1200080426),b=a(b,m,f,h,g[p+6],17,-1473231341),h=a(h,b,m,f,g[p+7],22,-45705983),f=a(f,h,b,m,g[p+8],7,1770035416),m=a(m,f,h,b,g[p+9],12,-1958414417),b=a(b,m,f,h,g[p+10],17,-42063),h=a(h,b,m,f,g[p+11],22,-1990404162),f=a(f,h,b,m,g[p+12],7,1804603682),m=a(m,f,h,b,g[p+13],12,-40341101),b=a(b,m,f,h,g[p+14],17,-1502002290),f=u(f,h=a(h,b,m,f,g[p+15],22,1236535329),b,m,g[p+1],5,-165796510),m=u(m,f,h,b,g[p+6],9,-1069501632),b=u(b,m,f,h,g[p+11],14,643717713),h=u(h,b,m,f,g[p+0],20,-373897302),f=u(f,h,b,m,g[p+5],5,-701558691),m=u(m,f,h,b,g[p+10],9,38016083),b=u(b,m,f,h,g[p+15],14,-660478335),h=u(h,b,m,f,g[p+4],20,-405537848),f=u(f,h,b,m,g[p+9],5,568446438),m=u(m,f,h,b,g[p+14],9,-1019803690),b=u(b,m,f,h,g[p+3],14,-187363961),h=u(h,b,m,f,g[p+8],20,1163531501),f=u(f,h,b,m,g[p+13],5,-1444681467),m=u(m,f,h,b,g[p+2],9,-51403784),b=u(b,m,f,h,g[p+7],14,1735328473),f=c(f,h=u(h,b,m,f,g[p+12],20,-1926607734),b,m,g[p+5],4,-378558),m=c(m,f,h,b,g[p+8],11,-2022574463),b=c(b,m,f,h,g[p+11],16,1839030562),h=c(h,b,m,f,g[p+14],23,-35309556),f=c(f,h,b,m,g[p+1],4,-1530992060),m=c(m,f,h,b,g[p+4],11,1272893353),b=c(b,m,f,h,g[p+7],16,-155497632),h=c(h,b,m,f,g[p+10],23,-1094730640),f=c(f,h,b,m,g[p+13],4,681279174),m=c(m,f,h,b,g[p+0],11,-358537222),b=c(b,m,f,h,g[p+3],16,-722521979),h=c(h,b,m,f,g[p+6],23,76029189),f=c(f,h,b,m,g[p+9],4,-640364487),m=c(m,f,h,b,g[p+12],11,-421815835),b=c(b,m,f,h,g[p+15],16,530742520),f=d(f,h=c(h,b,m,f,g[p+2],23,-995338651),b,m,g[p+0],6,-198630844),m=d(m,f,h,b,g[p+7],10,1126891415),b=d(b,m,f,h,g[p+14],15,-1416354905),h=d(h,b,m,f,g[p+5],21,-57434055),f=d(f,h,b,m,g[p+12],6,1700485571),m=d(m,f,h,b,g[p+3],10,-1894986606),b=d(b,m,f,h,g[p+10],15,-1051523),h=d(h,b,m,f,g[p+1],21,-2054922799),f=d(f,h,b,m,g[p+8],6,1873313359),m=d(m,f,h,b,g[p+15],10,-30611744),b=d(b,m,f,h,g[p+6],15,-1560198380),h=d(h,b,m,f,g[p+13],21,1309151649),f=d(f,h,b,m,g[p+4],6,-145523070),m=d(m,f,h,b,g[p+11],10,-1120210379),b=d(b,m,f,h,g[p+2],15,718787259),h=d(h,b,m,f,g[p+9],21,-343485551),f=o(f,y),h=o(h,v),b=o(b,w),m=o(m,x);return r(f)+r(h)+r(b)+r(m)}function j(t){return"undefined"!=typeof DOMException&&t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)}const I=(t,e="")=>{let r=!1;const o=new Set,s=e.length;for(let n=0;n<t.length;n++){const r=t.key(n);r.startsWith(e)&&o.add(r.substring(s))}const i={get:(n,r)=>{const o=t.getItem(e+n);return null===o?r:o},getJson:(t,e)=>i.getByType("json",t,e),getByType:(t,e,n)=>{const r=i.get(e+"_"+t);if(void 0===r)return n;switch(t){case"json":return JSON.parse(r)}throw Error(`Unsupported type "${t}" for decoding given!`)},has:t=>o.has(t),hasJson:t=>i.hasByType(t,"json"),hasByType:(t,e)=>i.has(t+"_"+e),set:(s,i)=>{if(!n(i))throw Error(`Expected value for id "${s}" to be a string but got ${typeof i}`);try{t.setItem(e+s,i)}catch(t){return j(t)&&(r=!0),!1}return o.add(s),!0},setJson:(t,e)=>i.setByType("json",t,e),setByType:(t,e,n)=>{if(void 0===n)throw Error(`Cannot store undefined value for id "${e}"`);const r=i.encode(t,n);return i.set(e+"_"+t,r)},delete:n=>!!o.has(n)&&(t.removeItem(e+n),o.delete(n),r=!1,!0),deleteJson:t=>i.deleteByType("json",t),deleteByType:(t,e)=>i.delete(e+"_"+t),keys:()=>[...o],isAvailable:()=>{try{const e="__storage_test__";return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return"undefined"!=typeof DOMException&&e instanceof DOMException&&!j(e)&&(22===e.code||1014===e.code)&&t&&0!==t.length}},isFull:()=>r,size:()=>o.size,encode:(t,e)=>{switch(t){case"json":return JSON.stringify(e)}throw Error(`Unsupported type "${t}" for encoding given!`)}};return i},_=()=>{const t=new Map;return I({setItem:(e,n)=>t.set(e,n),getItem:e=>{const n=t.get(e);return void 0===n?null:n},hasItem:e=>t.has(e)})},B={};let J=null,O=null,$=null,T=null,C=null,P=!0,L=null;const M={getStorages:()=>{if(!J){if(null===L)throw Error("No store prefix was set");const t=`${L}${T}.`;J={global:I(localStorage,`${L}global.`),api:I(localStorage,t),session:I(sessionStorage,t),temp:_()}}return J},setStorages:t=>{J=t},clearJwtCookie(){document.cookie=`${C}=; Max-Age=-9999; path=/`},clearJwt(){M.tokenStorage.delete("jwt"),M.clearJwtCookie()},setJwt(t){M.tokenStorage.set("jwt",t),document.cookie=`${C}=${t}; path=/`},getStoredJwt:()=>M.tokenStorage.get("jwt"),set apiId(t){T=t},set permanent(t){P=t},set storePrefix(t){L=t},set jwtCookieKey(t){C=t},get fixJwt(){return $},set fixJwt(t){$=t},get globalStorage(){return M.getStorages().global},get apiStorage(){return M.getStorages().api},get sessionStorage(){return M.getStorages().session},get tempStorage(){return M.getStorages().temp},get tokenStorage(){return M[P?"apiStorage":"sessionStorage"]},registerApp:(t,e,n)=>{B[t]={create:e,destroy:n}},setAppOverwrites:(t,e)=>{M.hasApp(t,!0),B[t].overwrites=e},hasApp:(t,e=!1)=>{const n=!!B[t];if(e&&!n)throw Error(`App with id "${t}" was not registered`);return n},startApp:(t,e={})=>{const n=B[t];if(!n)throw Error(`Invalid app id "${t}" given!`);n.config?e=n.config:n.config=e;const{create:r,overwrites:o={}}=n,s=()=>{requestAnimationFrame((()=>{O=t;const n=()=>{r({...e,...o})};"loading"===document.readyState?addEventListener("DOMContentLoaded",n,{once:!0}):n()}))};if(O){const{destroy:t}=B[O];t&&t(),requestAnimationFrame((()=>s()))}else s()}};window.controller=M;const D=M,N={buttonBg_rgb:"224 224 224",buttonText_rgb:"101 95 95",buttonBorder_rgb:"165 152 152",buttonPaddingX_px:6,buttonPaddingY_px:3,inputBg_rgb:"120 150 150",inputText_rgb:"240 240 240",inputBorder_rgb:"60 60 60",inputPaddingX_px:6,inputPaddingY_px:3},U=document.documentElement,R=["px","rem","rgb","rgba","px","urls","url","font","bstyle","float","perc","grad","type"],q={},F={},z=undefined;(t=>{for(let e of Object.keys(t)){const t=e.split("_");if(2!==t.length)continue;const[n,r]=t;if(!r||!R.includes(r))continue;q[e]=r;const o=[];let s=0,i="";for(;s<n.length;){let t=n[s];t>="A"&&t<="Z"&&(o.push(i),i="",t=t.toLowerCase()),i+=t,s++}""!==i&&o.push(i);const a="--"+o.join("-");F[e]=a}})(N);let K=null,W=null;const X={init:()=>{const t=window.controller.globalStorage;K={...N};const e=t&&t.getJson("theme");if(e)for(const[t,r]of Object.entries(e)){const e=N[t];if(e){let o=void 0===N[t];switch(q[t]){case"px":o=a(r);break;case"rgb":o=n(r);break}o||(console.log(`Invalid value "${r}" for theme key "${t}" using default "${e}" instead`),r=e)}K[t]=r}X.apply(K)},store:()=>{const t=undefined;window.controller.globalStorage.setJson("theme",K)},applyProp:(t,e,n=U)=>{const r=F[t],o=q[t];if(!r||!o)return;let s=["px","rem"].includes(o)?o:"";n.style.setProperty(r,e+s),n===U&&(K[t]=e)},apply:(t,e=U)=>{for(const[n,r]of Object.entries(t))X.applyProp(n,r,e)},applyBackup:t=>{if(null!==W)throw Error("Cannot store multiple theme backups");W={...K},X.apply(W,t)},deleteBackup:()=>{W=null},restoreBackup:()=>{X.apply(W),W=null},get currentTheme(){return K},get defaultTheme(){return N}},Y=X,H=new URL(window.location.href);H.search="";const Q=H.toString();let Z=null;const G=()=>Z().catch((t=>{console.error(t),tt(),document.getElementById("error-info").innerText=t.message,document.getElementById("retry-btn").focus()})),V=t=>{Z=t,G()},tt=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!1)},et=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!0)};function nt(t){if(!t.apiId)throw Error('Missing required value for confgi  key "apiId"');D.apiId=t.apiId,D.permanent=t.permanent,D.storePrefix=t.storePrefix,D.jwtCookieKey=t.jwtCookieKey;const e=t=>{if(D.hasApp("apixt"))D.startApp("apixt",t);else{const t=document.createElement("script");t.src=`${Q}/index.js`,document.head.appendChild(t)}},n=()=>{D.setJwt(D.fixJwt),e({})},r=()=>{const t=D.tokenStorage.get("lastUsername"),r=document.getElementById("username");t&&(r.value=t),r.value&&document.getElementById("password").focus();const o=D.getStoredJwt();if(D.fixJwt)return o===D.fixJwt?n():D.clearJwt(),void 0;o&&!D.hasApp("apixt")&&V((()=>fetch(Q+"/refresh",{headers:{Authorization:`Bearer ${o}`}}).then((t=>{if(401===t.status)return D.clearJwt(),void 0;if(!t.ok||200!==t.status)throw Error(`Could not refresh token. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{jwt:n,config:r}=t;D.setJwt(n),e(r)}))))},o=function(t){t.preventDefault();const r=new FormData(document.getElementById("login-form")),o=new URLSearchParams(r),s=r.get("username");if(s&&D.tokenStorage.set("lastUsername",s),D.fixJwt)return n(),void 0;V((()=>fetch(Q,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then((t=>{if(401===t.status){const t=document.getElementById("login-form").classList;t.toggle("shake-anim",!0);const e=document.getElementsByTagName("input");for(const t of e)t.setAttribute("maxlength","0");return setTimeout((()=>{t.remove("shake-anim");for(const t of e)t.removeAttribute("maxlength");document.getElementById("password").focus()}),500),void 0}if(!t.ok)throw Error(`Could not login. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{config:n,jwt:r}=t;D.setJwt(r),e(n)}))))};document.body.innerHTML='<div class="full bg-app-bg text-app-text"><div id="overlay" class="hidden full bg-overlay-bg/50 absolute"><div class="grid place-items-center h-full w-full"><div class="text-center bg-warning-bg text-warning-text w-full py-3"><div class="stack-v gap-3"><div class="text-warning-text/50">An error occured:</div><div id="error-info"></div><div class="stack-h gap-2 place-content-center"><button id="retry-btn" class="bg-button-bg text-button-text border-button-border border px-2">Retry</button><button id="cancel-btn" class="bg-button-bg text-button-text border-button-border border px-2">Cancel</button></div></div></div ></div></div><div class="grid place-content-center h-full"><form id="login-form" class="text-center"><div id="login-div" class="stack-v gap-2 border-header-border border shadow-md"><div class="bg-header-bg text-header-text px-2">Login</div><div class="grid gap-1 py-1 grid-cols-[min-content_auto] p-3"><div class="text-xs">Username:</div><input id="username" name="username" type="text" autocomplete="username" required class="invalid:bg-warning-bg invalid:text-warning-text px-dix py-diy bg-input-bg text-input-text border-input-border" /><div class="text-xs">Password:</div><input id="password" type="password" name="password" autocomplete="current-password" required class="invalid:bg-warning-bg invalid:text-warning-text px-dix py-diy bg-input-bg text-input-text border-input-border" /></div><div class="pb-2"><button type="submit" class="bg-button-bg text-button-text border border-button-border text-xs px-dbx py-dby">Submit</button></div></div></div></form></div></div>',document.getElementById("login-form").addEventListener("submit",o),document.getElementById("retry-btn").addEventListener("click",(()=>{et(),G()})),document.getElementById("cancel-btn").addEventListener("click",et),requestAnimationFrame((()=>{Y.init(),r()}))}D.registerApp("login",nt)})();