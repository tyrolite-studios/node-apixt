(()=>{"use strict";function t(t,...e){let n=[];try{throw Error("foo")}catch(t){n=t.stack.split("\n")}const r=[];let o=0;for(const t of n){const e=o;if(o++,e<=1)continue;if(2===e){r.push(t.trim());continue}if(e>6)break;const[n]=t.split("(");r.push(n.substring(6).trim())}return console.group("Debug "+r.join(" <- ")),console.log(t,...e),console.groupEnd(),t}const e=t=>null===t;function n(t){return"string"==typeof t}function r(t){return Array.isArray(t)}function o(t){return!!t&&"object"==typeof t&&!r(t)}function s(t){return"number"==typeof t&&!isNaN(t)}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t&&Number.isInteger(t)}function d(t){return"boolean"==typeof t}function c(t){if(!t)return[];const e=/\b(full|w-full|h-full)\b/g;return t.match(e)||[]}function u(t){const e=new l(t);return new Proxy(e,{set:(t,n,r)=>(e.add(n,r),!0)})}class l{constructor(t={}){this._props={},this.add(t)}get style(){let t=this._props.style;return t||(t={},this._props.style=t),t}get props(){return this._props}setStyle(t,e){return this.style[t]=e,this}setStyles(t){for(const[e,n]of Object.entries(t))this.setStyle(e,n);return this}add(t,e){if(o(t)){for(const[e,n]of Object.entries(t))this._props[e]=n;return this}return this._props[t]=e,this}}function p(t="",e=""){return new g(t,e)}class g{constructor(t="",e=""){this.cls=[],this.add(t),this.overwrites=e}add(t=""){t&&this.cls.push(t)}addIf(t,e,n=""){t?this.add(e):this.add(n)}addIfProps(t){for(const[e,n]of Object.entries(t))i(n)&&(n=n()),n&&this.add(e)}getDeletesAndAdds(){const t=this.overwrites.split(" "),e=[],n=[];for(const r of t)r.startsWith("not_")?e.push(r.substring(4)):n.push(r);return{adds:n,deletes:e}}get value(){const t=this.cls.join(" ");if(!this.overwrites)return t;const{adds:e,deletes:n}=this.getDeletesAndAdds(),r=undefined;return[...t.split(" ").filter((t=>!n.includes(t))),...e].join(" ")}}function f(t,e){const n=t.clientX,r=t.clientY;return n>=e.left&&n<=e.right&&r>=e.top&&r<=e.bottom}function h(t,e,n){return!(void 0!==e&&t<e)&&!(void 0!==n&&t>n)}const b=t=>{try{return JSON.parse(t),!0}catch(t){return!1}};function m(t,e,n){const r=null===t?e:Math.max(t,e);return null==n?r:Math.min(r,n)}const y=(t,e=0,n=!1)=>{const r=e;let o=1;for(;e-- >0;)o*=10;let s=Math.round(t*o)/o;if(n){const t=(""+s).split(".");1===t.length&&t.push(""),t[1]=t[1].padEnd(r,"0"),s=t.join(".")}return s};function w(t){if(void 0!==t){if(null===t)return null;if(Array.isArray(t))return t.map((t=>w(t)));if("object"==typeof t){const e={};for(let[n,r]of Object.entries(t))e[n]=w(r);return e}return t}}function v(t){const[e,n,r,o]=t.split(" ");return"#"+parseInt(e).toString(16).padStart(2,"0")+parseInt(n).toString(16).padStart(2,"0")+parseInt(r).toString(16).padStart(2,"0")+(void 0===o?"":parseInt(o).toString(16).padStart(2,"0"))}function x(t){return"undefined"!=typeof DOMException&&t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)}const S=(t,e="")=>{let r=!1;const o=new Set,s=e.length;for(let n=0;n<t.length;n++){const r=t.key(n);r.startsWith(e)&&o.add(r.substring(s))}const i={get:(n,r)=>{const o=t.getItem(e+n);return null===o?r:o},getJson:(t,e)=>i.getByType("json",t,e),getByType:(t,e,n)=>{const r=i.get(e+"_"+t);if(void 0===r)return n;switch(t){case"json":return JSON.parse(r)}throw Error(`Unsupported type "${t}" for decoding given!`)},has:t=>o.has(t),hasJson:t=>i.hasByType(t,"json"),hasByType:(t,e)=>i.has(t+"_"+e),set:(s,i)=>{if(!n(i))throw Error(`Expected value for id "${s}" to be a string but got ${typeof i}`);try{t.setItem(e+s,i)}catch(t){return x(t)&&(r=!0),!1}return o.add(s),!0},setJson:(t,e)=>i.setByType("json",t,e),setByType:(t,e,n)=>{if(void 0===n)throw Error(`Cannot store undefined value for id "${e}"`);const r=i.encode(t,n);return i.set(e+"_"+t,r)},delete:n=>!!o.has(n)&&(t.removeItem(e+n),o.delete(n),r=!1,!0),deleteJson:t=>i.deleteByType("json",t),deleteByType:(t,e)=>i.delete(e+"_"+t),keys:()=>[...o],isAvailable:()=>{try{const e="__storage_test__";return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return"undefined"!=typeof DOMException&&e instanceof DOMException&&!x(e)&&(22===e.code||1014===e.code)&&t&&0!==t.length}},isFull:()=>r,size:()=>o.size,encode:(t,e)=>{switch(t){case"json":return JSON.stringify(e)}throw Error(`Unsupported type "${t}" for encoding given!`)}};return i},E=()=>{const t=new Map;return S({setItem:(e,n)=>t.set(e,n),getItem:e=>{const n=t.get(e);return void 0===n?null:n},hasItem:e=>t.has(e)})},k={};let I=null,_=null,j=null,A=null,B=null,J=!0,$=null;const T={getStorages:()=>{if(!I){if(null===$)throw Error("No store prefix was set");const t=`${$}${A}.`;I={global:S(localStorage,`${$}global.`),api:S(localStorage,t),session:S(sessionStorage,t),temp:E()}}return I},clearJwtCookie(){document.cookie=`${B}=; Max-Age=-9999; path=/`},clearJwt(){T.tokenStorage.delete("jwt"),T.clearJwtCookie()},setJwt(t){T.tokenStorage.set("jwt",t),document.cookie=`${B}=${t}; path=/`},getStoredJwt:()=>T.tokenStorage.get("jwt"),set apiId(t){A=t},set permanent(t){J=t},set storePrefix(t){$=t},set jwtCookieKey(t){B=t},get fixJwt(){return j},set fixJwt(t){j=t},get globalStorage(){return T.getStorages().global},get apiStorage(){return T.getStorages().api},get sessionStorage(){return T.getStorages().session},get tempStorage(){return T.getStorages().temp},get tokenStorage(){return T[J?"apiStorage":"sessionStorage"]},registerApp:(t,e,n)=>{k[t]={create:e,destroy:n}},setAppOverwrites:(t,e)=>{T.hasApp(t,!0),k[t].overwrites=e},hasApp:(t,e=!1)=>{const n=!!k[t];if(e&&!n)throw Error(`App with id "${t}" was not registered`);return n},startApp:(t,e={})=>{const n=k[t];if(!n)throw Error(`Invalid app id "${t}" given!`);n.config?e=n.config:n.config=e;const{create:r,overwrites:o={}}=n,s=()=>{requestAnimationFrame((()=>{_=t;const n=()=>{r({...e,...o})};"loading"===document.readyState?addEventListener("DOMContentLoaded",n,{once:!0}):n()}))};if(_){const{destroy:t}=k[_];t&&t(),requestAnimationFrame((()=>s()))}else s()}};window.controller=T;const O=T,C={buttonBg_rgb:"224 224 224",buttonText_rgb:"101 95 95",buttonBorder_rgb:"165 152 152",buttonPaddingX_px:6,buttonPaddingY_px:3,inputBg_rgb:"120 150 150",inputText_rgb:"240 240 240",inputBorder_rgb:"60 60 60",inputPaddingX_px:6,inputPaddingY_px:3},P=document.documentElement,L=["px","rem","rgb","rgba","px","urls","url","font","bstyle","float","perc","grad","type"],D={},M={},N=undefined;(t=>{for(let e of Object.keys(t)){const t=e.split("_");if(2!==t.length)continue;const[n,r]=t;if(!r||!L.includes(r))continue;D[e]=r;const o=[];let s=0,i="";for(;s<n.length;){let t=n[s];t>="A"&&t<="Z"&&(o.push(i),i="",t=t.toLowerCase()),i+=t,s++}""!==i&&o.push(i);const a="--"+o.join("-");M[e]=a}})(C);let U=null,R=null,q=null;const F={init:()=>{if(q=window.controller.globalStorage,!q)throw Error("No global storage found");U={...C};const t=q.getJson("theme");if(t)for(const[e,r]of Object.entries(t)){const t=C[e];if(t){let o=void 0===C[e];switch(D[e]){case"px":o=a(r);break;case"rgb":o=n(r);break}o||(console.log(`Invalid value "${r}" for theme key "${e}" using default "${t}" instead`),r=t)}U[e]=r}F.apply(U)},store:()=>{q.setJson("theme",U)},applyProp:(t,e,n=P)=>{const r=M[t],o=D[t];if(!r||!o)return;let s=["px","rem"].includes(o)?o:"";n.style.setProperty(r,e+s),n===P&&(U[t]=e)},apply:(t,e=P)=>{for(const[n,r]of Object.entries(t))F.applyProp(n,r,e)},applyBackup:t=>{if(null!==R)throw Error("Cannot store multiple theme backups");R={...U},F.apply(R,t)},deleteBackup:()=>{R=null},restoreBackup:()=>{F.apply(R),R=null},get currentTheme(){return U},get defaultTheme(){return C}},z=F,K=new URL(window.location.href);K.search="";const X=K.toString();let Y=null;const H=()=>Y().catch((t=>{console.error(t),W(),document.getElementById("error-info").innerText=t.message,document.getElementById("retry-btn").focus()})),Q=t=>{Y=t,H()},W=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!1)},Z=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!0)};function G(t){O.apiId=t.apiId,O.permanent=t.permanent,O.storePrefix=t.storePrefix,O.jwtCookieKey=t.jwtCookieKey;const e=t=>{if(O.hasApp("apixt"))O.startApp("apixt",t);else{const t=document.createElement("script");t.src=`${X}/index.js`,document.head.appendChild(t)}},n=()=>{O.setJwt(O.fixJwt),e({})},r=()=>{const t=O.tokenStorage.get("lastUsername"),r=document.getElementById("username");t&&(r.value=t),r.value&&document.getElementById("password").focus();const o=O.getStoredJwt();if(O.fixJwt)return o===O.fixJwt?n():O.clearJwt(),void 0;o&&!O.hasApp("apixt")&&Q((()=>fetch(X+"/refresh",{headers:{Authorization:`Bearer ${o}`}}).then((t=>{if(401===t.status)return O.clearJwt(),void 0;if(!t.ok||200!==t.status)throw Error(`Could not refresh token. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{jwt:n,config:r}=t;O.setJwt(n),e(r)}))))},o=function(t){t.preventDefault();const r=new FormData(document.getElementById("login-form")),o=new URLSearchParams(r),s=r.get("username");if(s&&O.tokenStorage.set("lastUsername",s),O.fixJwt)return n(),void 0;Q((()=>fetch(X,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then((t=>{if(401===t.status){const t=document.getElementById("login-form").classList;t.toggle("shake-anim",!0);const e=document.getElementsByTagName("input");for(const t of e)t.setAttribute("maxlength","0");return setTimeout((()=>{t.remove("shake-anim");for(const t of e)t.removeAttribute("maxlength");document.getElementById("password").focus()}),500),void 0}if(!t.ok)throw Error(`Could not login. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{config:n,jwt:r}=t;O.setJwt(r),e(n)}))))};document.body.innerHTML='<div class="full bg-app-bg text-app-text"><div id="overlay" class="hidden full bg-overlay-bg/50 absolute"><div class="grid place-items-center h-full w-full"><div class="text-center bg-warning-bg text-warning-text w-full py-3"><div class="stack-v gap-3"><div class="text-warning-text/50">An error occured:</div><div id="error-info"></div><div class="stack-h gap-2 place-content-center"><button id="retry-btn" class="bg-button-bg text-button-text border-button-border border px-2">Retry</button><button id="cancel-btn" class="bg-button-bg text-button-text border-button-border border px-2">Cancel</button></div></div></div ></div></div><div class="grid place-content-center h-full"><form id="login-form" class="text-center"><div id="login-div" class="stack-v gap-2 border-header-border border shadow-md"><div class="bg-header-bg text-header-text px-2">Login</div><div class="grid gap-1 py-1 grid-cols-[min-content_auto] p-3"><div class="text-xs">Username:</div><input id="username" name="username" type="text" autocomplete="username" required class="invalid:bg-warning-bg invalid:text-warning-text px-dix py-diy bg-input-bg text-input-text border-input-border" /><div class="text-xs">Password:</div><input id="password" type="password" name="password" autocomplete="current-password" required class="invalid:bg-warning-bg invalid:text-warning-text px-dix py-diy bg-input-bg text-input-text border-input-border" /></div><div class="pb-2"><button type="submit" class="bg-button-bg text-button-text border border-button-border text-xs px-dbx py-dby">Submit</button></div></div></div></form></div></div>',document.getElementById("login-form").addEventListener("submit",o),document.getElementById("retry-btn").addEventListener("click",(()=>{Z(),H()})),document.getElementById("cancel-btn").addEventListener("click",Z),requestAnimationFrame((()=>{z.init(),r()}))}O.registerApp("login",G)})();